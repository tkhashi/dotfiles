------------------------------------------------------------
-- Hammerspoon init.lua (New Architecture)
-- ãƒªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒ†ã‚£ãƒ³ã‚°æ¸ˆã¿: Mediator + Triggers + Repositories
-- ARCHITECTURE.md ã«å¾“ã£ãŸæ§‹é€ åŒ–è¨­è¨ˆ
------------------------------------------------------------

-- ğŸ’¡ æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®init.luaã®å½¹å‰²ï¼š
-- 1. ã‚³ãƒãƒ³ãƒ‰ç¾¤ã® register() ã‚’åˆ—æŒ™ï¼ˆä½•ãŒã§ãã‚‹ã‹ä¸€è¦§ï¼‰
-- 2. ãƒˆãƒªã‚¬ç¾¤ã® require() ã‚’åˆ—æŒ™ï¼ˆä½•ã§èµ·ã“ã™ã‹ä¸€è¦§ï¼‰  
-- 3. åˆæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸/èµ·å‹•æ™‚æ•´åˆã®ãƒˆãƒªã‚¬

------------------------------------------------------------
-- === ãƒ•ã‚§ãƒ¼ã‚º1: ã‚³ãƒãƒ³ãƒ‰ç™»éŒ²ï¼ˆä½•ãŒã§ãã‚‹ã‹ä¸€è¦§ï¼‰ ===
------------------------------------------------------------

-- IMEè¡¨ç¤ºãƒ»Karabinerãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«é–¢é€£
require("commands.input").register()

------------------------------------------------------------
-- === ãƒ•ã‚§ãƒ¼ã‚º2: ãƒˆãƒªã‚¬ãƒ¼èµ·å‹•ï¼ˆä½•ã§èµ·ã“ã™ã‹ä¸€è¦§ï¼‰ ===
------------------------------------------------------------

-- è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆ.luaãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ç›£è¦–ï¼‰
require("triggers.path")

-- æ‰‹å‹•ãƒ›ãƒƒãƒˆã‚­ãƒ¼ï¼ˆCtrl+Alt+Cmd+R/Wï¼‰
require("triggers.hotkey")

-- USBç›£è¦–ï¼ˆNaya Create Left æ¥ç¶š/åˆ‡æ–­ï¼‰
require("triggers.watchers.usb")

-- é›»æºç›£è¦–ï¼ˆå¾©å¸°/ã‚¢ãƒ³ãƒ­ãƒƒã‚¯æ™‚ï¼‰
require("triggers.watchers.power")

------------------------------------------------------------
-- === ãƒ•ã‚§ãƒ¼ã‚º3: åˆæœŸåŒ–å‡¦ç† ===
------------------------------------------------------------

-- IMEå¤‰æ›´æ™‚ã®ãƒˆãƒªã‚¬ãƒ¼è¨­å®šï¼ˆæ—¢å­˜æ©Ÿèƒ½ã®ç¶­æŒï¼‰
hs.keycodes.inputSourceChanged(function()
  local mediator = require("core.mediator")
  mediator.dispatch("input.ime.flash")
end)

-- èµ·å‹•å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
hs.alert.show("Hammerspoon ready (New Architecture)", 1.0)

-- èµ·å‹•æ™‚ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆï¼ˆæ—¢å­˜æ©Ÿèƒ½ã®ç¶­æŒï¼‰
hs.timer.doAfter(1.0, function()
  local mediator = require("core.mediator")
  mediator.dispatch("input.profile.reconcile")
end)